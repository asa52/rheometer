import numpy as np
import plotter as p

data = np.array([[[[1.57295990e+00, 7.14981775e-02],
                   [8.37100628e+03, 1.25690785e+01],
                   [-1.84886651e-01, 5.35011238e-03]]],
                 [[[1.62515541e+00, 3.12529886e-02],
                   [8.31552063e+03, 1.06472735e+01],
                   [-1.89303505e-01, 5.27789609e-03]]],
                 [[[1.69293116e+00, 3.84757081e-02],
                   [8.28720756e+03, 1.22230200e+01],
                   [-2.01989408e-01, 5.31398103e-03]]],
                 [[[1.77868428e+00, 2.77919418e-02],
                   [8.27936802e+03, 8.64234657e+00],
                   [-1.91126766e-01, 5.06376673e-03]]],
                 [[[1.88364265e+00, 5.88638329e-02],
                   [8.26015107e+03, 8.82494773e+00],
                   [-1.78721959e-01, 4.80282983e-03]]],
                 [[[2.00012293e+00, 5.55589703e-02],
                   [8.26889527e+03, 8.39481753e+00],
                   [-1.68097926e-01, 4.57114607e-03]]],
                 [[[2.12551636e+00, 3.12575935e-02],
                   [8.29076481e+03, 8.48594146e+00],
                   [-1.64357039e-01, 4.43428098e-03]]],
                 [[[2.12587344e+00, 6.25256895e-02],
                   [8.32493936e+03, 8.29177227e+00],
                   [-1.59807912e-01, 4.29345593e-03]]],
                 [[[2.26795194e+00, 6.67044688e-02],
                   [8.37042817e+03, 8.48927806e+00],
                   [-1.48199385e-01, 4.06739349e-03]]],
                 [[[2.28557798e+00, 7.14243119e-02],
                   [8.44044158e+03, 8.81048182e+00],
                   [-1.25980353e-01, 3.69811881e-03]]],
                 [[[2.35320076e+00, 2.94150095e-02],
                   [8.51724253e+03, 7.59789700e+00],
                   [-1.16177178e-01, 3.49686867e-03]]],
                 [[[2.50075107e+00, 6.25187767e-02],
                   [8.60633637e+03, 7.32454159e+00],
                   [-1.13253416e-01, 3.39774834e-03]]],
                 [[[2.58937477e+00, 5.88494266e-02],
                   [8.72777338e+03, 7.11309974e+00],
                   [-1.07949360e-01, 3.26748923e-03]]],
                 [[[2.57278213e+00, 3.57330851e-02],
                   [8.85598446e+03, 8.19240006e+00],
                   [-9.55217337e-02, 3.03261021e-03]]],
                 [[[2.75022345e+00, 6.25050785e-02],
                   [9.02046299e+03, 7.35763703e+00],
                   [-8.04597695e-02, 2.74857987e-03]]],
                 [[[2.82413722e+00, 5.88361922e-02],
                   [9.19596398e+03, 6.85243217e+00],
                   [-6.59801841e-02, 2.45876093e-03]]],
                 [[[2.82449456e+00, 2.94218184e-02],
                   [9.39819309e+03, 6.89017088e+00],
                   [-5.71330993e-02, 2.25906566e-03]]],
                 [[[2.94253392e+00, 5.88506784e-02],
                   [9.63899960e+03, 7.12416822e+00],
                   [-5.15087733e-02, 2.11756149e-03]]],
                 [[[3.05890328e+00, 5.88250631e-02],
                   [9.89734940e+03, 7.00945425e+00],
                   [-5.17840209e-02, 2.09486164e-03]]],
                 [[[3.17693967e+00, 2.94161081e-02],
                   [1.01968362e+04, 7.14064162e+00],
                   [-5.35546442e-02, 2.10212716e-03]]],
                 [[[3.17720923e+00, 5.88372079e-02],
                   [1.04266577e+04, 7.18089370e+00],
                   [-5.67910526e-02, 2.13621284e-03]]],
                 [[[3.29524806e+00, 5.88437154e-02],
                   [1.09182463e+04, 7.15481408e+00],
                   [-7.31215569e-02, 2.38775241e-03]]],
                 [[[3.42850784e+00, 3.57136234e-02],
                   [1.13533974e+04, 8.40992402e+00],
                   [-8.85910428e-02, 2.59002256e-03]]],
                 [[[3.44476383e+00, 5.55607069e-02],
                   [1.18437434e+04, 7.68076745e+00],
                   [-1.02731084e-01, 2.74992450e-03]]],
                 [[[3.50069628e+00, 6.25124335e-02],
                   [1.23921174e+04, 7.89306841e+00],
                   [-1.13471807e-01, 2.85185546e-03]]],
                 [[[3.62608905e+00, 6.25187767e-02],
                   [1.30345020e+04, 8.21847542e+00],
                   [-1.17774283e-01, 2.87078654e-03]]],
                 [[[3.64850855e+00, 5.88469122e-02],
                   [1.37737962e+04, 8.15500073e+00],
                   [-1.28072986e-01, 2.95574982e-03]]],
                 [[[3.69235602e+00, 3.84620419e-02],
                   [1.46007177e+04, 1.00555907e+01],
                   [-1.38696900e-01, 3.03747776e-03]]],
                 [[[3.88291759e+00, 2.94160423e-02],
                   [1.55914668e+04, 9.18766457e+00],
                   [-1.56101867e-01, 3.17931232e-03]]],
                 [[[3.84720153e+00, 3.84720153e-02],
                   [1.67234542e+04, 1.11267161e+01],
                   [-1.58374392e-01, 3.16816858e-03]]],
                 [[[4.00120171e+00, 7.14500306e-02],
                   [1.80473442e+04, 1.09444173e+01],
                   [-1.55261491e-01, 3.10686199e-03]]],
                 [[[4.12503628e+00, 6.25005497e-02],
                   [1.96723232e+04, 1.10024179e+01],
                   [-1.58486909e-01, 3.10622551e-03]]],
                 [[[4.12541336e+00, 6.25062630e-02],
                   [2.15774766e+04, 1.19278478e+01],
                   [-1.58192513e-01, 3.07337653e-03]]],
                 [[[4.18260509e+00, 4.54630988e-02],
                   [2.39294847e+04, 1.71537525e+01],
                   [-1.64944409e-01, 3.10491692e-03]]],
                 [[[4.28688379e+00, 7.14480631e-02],
                   [2.68269118e+04, 1.49453548e+01],
                   [-1.52009619e-01, 2.95925419e-03]]],
                 [[[4.35448436e+00, 2.94221916e-02],
                   [3.05930314e+04, 1.44511249e+01],
                   [-1.27663047e-01, 2.69801148e-03]]],
                 [[[4.47086302e+00, 5.88271450e-02],
                   [3.54149663e+04, 1.80596462e+01],
                   [-1.05470755e-01, 2.43916781e-03]]],
                 [[[4.53387538e+00, 6.66746379e-02],
                   [4.18408801e+04, 2.06417761e+01],
                   [-7.60913604e-02, 2.06338213e-03]]],
                 [[[4.71533944e+00, 3.57222685e-02],
                   [5.08195404e+04, 2.61821434e+01],
                   [-1.47012990e-01, 2.81005982e-03]]],
                 [[[4.75132229e+00, 6.25173985e-02],
                   [6.31670052e+04, 3.07681467e+01],
                   [-2.95060899e-01, 3.84819633e-03]]],
                 [[[4.75013256e+00, 3.12508721e-02],
                   [7.96199401e+04, 3.57040090e+01],
                   [-5.02648289e-01, 4.79546616e-03]]],
                 [[[4.87551419e+00, 6.25065922e-02],
                   [9.63795408e+04, 4.11175515e+01],
                   [-8.14391753e-01, 5.68478997e-03]]],
                 [[[5.00090273e+00, 6.25112841e-02],
                   [1.00757318e+05, 4.22817111e+01],
                   [-1.18209598e+00, 6.23360206e-03]]],
                 [[[5.00126618e+00, 3.12579136e-02],
                   [8.85170644e+04, 3.71140731e+01],
                   [-1.52562452e+00, 6.37960096e-03]]],
                 [[[5.12499262e+00, 6.24999099e-02],
                   [7.14730516e+04, 3.12929298e+01],
                   [-1.77142127e+00, 6.28019540e-03]]],
                 [[[5.17674475e+00, 5.88266449e-02],
                   [5.82301255e+04, 2.53284582e+01],
                   [-1.93617202e+00, 6.11064951e-03]]],
                 [[[5.29477549e+00, 5.88308388e-02],
                   [4.85532517e+04, 2.17240500e+01],
                   [-2.05220692e+00, 5.93499815e-03]]],
                 [[[5.41291036e+00, 2.94179911e-02],
                   [4.13595083e+04, 1.77584836e+01],
                   [-2.12842732e+00, 5.78516030e-03]]],
                 [[[5.44596111e+00, 5.55710317e-02],
                   [3.61303503e+04, 1.65205077e+01],
                   [-2.17940515e+00, 5.66260945e-03]]],
                 [[[5.52964411e+00, 5.88260011e-02],
                   [3.21608892e+04, 1.20678759e+01],
                   [-2.22017621e+00, 5.55215994e-03]]],
                 [[[5.66728652e+00, 2.77808163e-02],
                   [2.90076127e+04, 1.24656694e+01],
                   [-2.24579453e+00, 5.46632503e-03]]],
                 [[[5.66765752e+00, 8.33479047e-02],
                   [2.65342093e+04, 1.30261214e+01],
                   [-2.27780648e+00, 5.36759574e-03]]],
                 [[[5.73470081e+00, 6.66825675e-02],
                   [2.45198450e+04, 9.74944135e+00],
                   [-2.30036598e+00, 5.28598934e-03]]],
                 [[[5.85711462e+00, 7.14282271e-02],
                   [2.28495237e+04, 9.64114922e+00],
                   [-2.30888404e+00, 5.23255840e-03]]],
                 [[[5.87546761e+00, 3.12524873e-02],
                   [2.14602031e+04, 7.94234015e+00],
                   [-2.32488272e+00, 5.16464173e-03]]],
                 [[[6.00074084e+00, 6.66748982e-02],
                   [2.02933787e+04, 7.99266588e+00],
                   [-2.33815725e+00, 5.10263111e-03]]],
                 [[[6.11234974e+00, 5.55668158e-02],
                   [1.92991958e+04, 7.02299700e+00],
                   [-2.35562517e+00, 5.03216776e-03]]],
                 [[[6.15379562e+00, 7.69224453e-02],
                   [1.84350293e+04, 7.77193479e+00],
                   [-2.37303051e+00, 4.96184965e-03]]],
                 [[[6.25033042e+00, 6.25033042e-02],
                   [1.76845325e+04, 6.46837325e+00],
                   [-2.38277771e+00, 4.90856569e-03]]],
                 [[[6.37571656e+00, 6.25070251e-02],
                   [1.70361436e+04, 6.19947000e+00],
                   [-2.39629672e+00, 4.84735716e-03]]],
                 [[[6.47169116e+00, 2.94167780e-02],
                   [1.64544232e+04, 5.61968007e+00],
                   [-2.41135419e+00, 4.78292586e-03]]],
                 [[[6.47205752e+00, 5.88368865e-02],
                   [1.59304838e+04, 5.42591412e+00],
                   [-2.43304335e+00, 4.70314230e-03]]],
                 [[[6.62529546e+00, 3.12513937e-02],
                   [1.54671609e+04, 5.23600573e+00],
                   [-2.45484830e+00, 4.62238243e-03]]],
                 [[[6.62546407e+00, 6.25043780e-02],
                   [1.50303958e+04, 5.05393270e+00],
                   [-2.47013903e+00, 4.55709144e-03]]],
                 [[[6.75084934e+00, 6.25078643e-02],
                   [1.46191408e+04, 4.87629779e+00],
                   [-2.49249652e+00, 4.47386440e-03]]],
                 [[[6.82486400e+00, 5.88350345e-02],
                   [1.42484372e+04, 4.73212794e+00],
                   [-2.51447244e+00, 4.39071715e-03]]],
                 [[[6.94122431e+00, 2.94119674e-02],
                   [1.38719868e+04, 4.58881470e+00],
                   [-2.54243486e+00, 4.29027651e-03]]],
                 [[[6.94160311e+00, 5.88271450e-02],
                   [1.35099586e+04, 4.23244316e+00],
                   [-2.57297962e+00, 4.18021867e-03]]],
                 [[[7.05963388e+00, 5.88302823e-02],
                   [1.31635738e+04, 4.01206150e+00],
                   [-2.59577385e+00, 4.09019647e-03]]],
                 [[[7.17766862e+00, 2.94166747e-02],
                   [1.27963556e+04, 3.91086663e+00],
                   [-2.62510316e+00, 3.97859845e-03]]],
                 [[[7.17803450e+00, 2.94181742e-02],
                   [1.24268738e+04, 3.74190720e+00],
                   [-2.65395468e+00, 3.86537321e-03]]],
                 [[[7.29450276e+00, 5.88266351e-02],
                   [1.20711246e+04, 3.64356313e+00],
                   [-2.68748502e+00, 3.73286702e-03]]],
                 [[[7.37556414e+00, 6.25047809e-02],
                   [1.16907274e+04, 3.54479303e+00],
                   [-2.71922018e+00, 3.60147674e-03]]],
                 [[[7.44549235e+00, 5.55633757e-02],
                   [1.13020782e+04, 3.40321534e+00],
                   [-2.74566908e+00, 3.48489057e-03]]],
                 [[[7.53074327e+00, 5.88339318e-02],
                   [1.09228443e+04, 3.21638525e+00],
                   [-2.77680152e+00, 3.34599634e-03]]],
                 [[[7.64720510e+00, 5.88246546e-02],
                   [1.05266059e+04, 3.10427778e+00],
                   [-2.80442166e+00, 3.21570557e-03]]],
                 [[[7.73386266e+00, 6.66712298e-02],
                   [1.01296661e+04, 3.05294335e+00],
                   [-2.83398468e+00, 3.07147836e-03]]],
                 [[[7.73423621e+00, 3.33372251e-02],
                   [9.73779856e+03, 2.92514225e+00],
                   [-2.86232801e+00, 2.92593045e-03]]],
                 [[[7.85843200e+00, 7.14402909e-02],
                   [9.34646743e+03, 2.90533647e+00],
                   [-2.88436676e+00, 2.80444001e-03]]],
                 [[[8.00000426e+00, 3.57143047e-02],
                   [8.96341035e+03, 2.76648468e+00],
                   [-2.90853046e+00, 2.66702000e-03]]],
                 [[[8.00047682e+00, 5.55588668e-02],
                   [8.58803046e+03, 2.52812201e+00],
                   [-2.93073897e+00, 2.53365348e-03]]],
                 [[[8.13399158e+00, 6.66720621e-02],
                   [8.22100494e+03, 2.36575682e+00],
                   [-2.94927794e+00, 2.41527283e-03]]],
                 [[[8.13436417e+00, 3.33375581e-02],
                   [7.86783336e+03, 2.25439351e+00],
                   [-2.96665092e+00, 2.29900371e-03]]],
                 [[[8.26819696e+00, 6.66790077e-02],
                   [7.52744380e+03, 2.14579356e+00],
                   [-2.97947394e+00, 2.20710245e-03]]],
                 [[[8.37524491e+00, 6.25018277e-02],
                   [7.20176904e+03, 1.95593945e+00],
                   [-2.99289548e+00, 2.10829986e-03]]],
                 [[[8.37562168e+00, 3.12523197e-02],
                   [6.89217098e+03, 1.86476488e+00],
                   [-3.00345183e+00, 2.02592656e-03]]],
                 [[[8.50100616e+00, 6.25073982e-02],
                   [6.59887453e+03, 1.78637643e+00],
                   [-3.01113035e+00, 1.96198888e-03]]],
                 [[[8.58962393e+00, 5.88330406e-02],
                   [6.31875124e+03, 1.74262307e+00],
                   [-3.02131696e+00, 1.87816932e-03]]],
                 [[[8.70588679e+00, 2.94117797e-02],
                   [6.05540649e+03, 1.57775052e+00],
                   [-3.02654212e+00, 1.82995617e-03]]],
                 [[[8.77817039e+00, 5.55580404e-02],
                   [5.80712690e+03, 1.59186593e+00],
                   [-3.03286755e+00, 1.77260005e-03]]],
                 [[[8.82439429e+00, 5.88292953e-02],
                   [5.57233350e+03, 1.44398380e+00],
                   [-3.03566761e+00, 1.74244048e-03]]],
                 [[[8.94232939e+00, 5.88311144e-02],
                   [5.35429964e+03, 1.38461330e+00],
                   [-3.03480055e+00, 1.74140031e-03]]],
                 [[[8.94113760e+00, 2.94116368e-02],
                   [5.14796605e+03, 1.34236403e+00],
                   [-3.03797020e+00, 1.70856206e-03]]],
                 [[[9.05916545e+00, 5.88257496e-02],
                   [4.95191639e+03, 1.28221553e+00],
                   [-3.03894699e+00, 1.69320461e-03]]],
                 [[[9.17719644e+00, 5.88281823e-02],
                   [4.77098886e+03, 1.21399208e+00],
                   [-3.03941913e+00, 1.68200240e-03]]],
                 [[[9.17756936e+00, 2.94152864e-02],
                   [4.60259885e+03, 1.18410055e+00],
                   [-3.03758595e+00, 1.68910414e-03]]],
                 [[[9.25147702e+00, 3.12549899e-02],
                   [4.44156589e+03, 1.10103269e+00],
                   [-3.03440533e+00, 1.70642716e-03]]],
                 [[[9.37509638e+00, 6.25006425e-02],
                   [4.29263561e+03, 1.04698430e+00],
                   [-3.03384553e+00, 1.70337725e-03]]],
                 [[[9.50068844e+00, 6.25045292e-02],
                   [4.15255912e+03, 1.01778410e+00],
                   [-3.03144185e+00, 1.71427145e-03]]],
                 [[[9.55642687e+00, 5.55606213e-02],
                   [4.02028641e+03, 1.08509755e+00],
                   [-3.03110834e+00, 1.70952629e-03]]]])

k = 0.00012
k_pr = 0.00002
b = 5.01e-7
b_pr = 1e-9
i = 10 ** (-7)
d = 0.19
w = np.linspace(10, 60, 500)

freqs = data[:, :, 0, :].squeeze() * 2 * np.pi
amp = data[:, :, 1, :].squeeze() * i
phase = data[:, :, 2, :].squeeze()


# calculate theory with w-interval delay
w_int = np.linspace(10, 60, 100)
R_int = 1 / (
    ((k - k_pr * np.cos(w_int * d) - b_pr * w_int * np.sin(w_int * d)) / i -
     w_int ** 2) +
    (b - b_pr * np.cos(w_int * d) + k_pr / w_int * np.sin(w_int * d)) / i *
    w_int * 1j)
delay_phase_int = np.angle(R_int)

# Calculate theory with delay
R_expected_delay = 1 / (
    ((k - k_pr * np.cos(w * d) - b_pr * w * np.sin(w * d)) / i - w ** 2) +
    (b - b_pr * np.cos(w * d) + k_pr / w * np.sin(w * d)) / i * w * 1j)
delay_amp = np.absolute(R_expected_delay)
delay_phase = np.angle(R_expected_delay)

# change sign of wrong phase mmt
idcs = np.where(delay_phase_int > 0)
phase[idcs, 0] *= -1

# Calculate theory without delay
d = 0
R_expected_delay = 1 / (
    ((k - k_pr * np.cos(w * d) - b_pr * w * np.sin(w * d)) / i - w ** 2) +
    (b - b_pr * np.cos(w * d) + k_pr / w * np.sin(w * d)) / i * w * 1j)
nodelay_amp = np.absolute(R_expected_delay)
nodelay_phase = np.angle(R_expected_delay)

plotter_input = \
    [[
        [[freqs, amp, 'Simulated, $d=0.19$'],
         [w, delay_amp, 'Theoretical, $d=0.19$'],
         [w, nodelay_amp, 'Theoretical, $d=0.00$']],
        [[freqs, phase, 'Simulated, $d=0.19$'],
         [w, delay_phase, 'Theoretical, $d=0.19$'],
         [w, nodelay_phase, 'Theoretical, $d=0.00$']]
    ]]

p.two_by_n_plotter(
    plotter_input, 'response-test-delay', {}, savepath=None, show=True,
    x_axes_labels=['$\omega$/rad/s'], y_top_labels=['$|R(\omega)|$'],
    y_bottom_labels=['$\phi[R(\omega)]$'], legend={'fontsize': 14})
